<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AI æ™ºèƒ½æ‰‹ç›¸ & é¢ç›¸å¤§å¸ˆ | AI Destiny Master</title>
    
    <!-- Vercel Analytics Script (è‡ªåŠ¨ç»Ÿè®¡è®¿é—®é‡) -->
    <script>
      window.va = window.va || function () { (window.va.q = window.va.q || []).push(arguments); };
    </script>
    <script src="/_vercel/insights/script.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* ... existing styles ... */
        body {
            font-family: 'Noto Serif SC', serif;
            background-color: #1a0b2e;
            color: #e2d8f0;
            background-image: radial-gradient(circle at 50% 0%, #2d1b4e 0%, #1a0b2e 70%);
            min-height: 100vh;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        .mystic-border {
            border: 1px solid rgba(216, 180, 254, 0.3);
            box-shadow: 0 0 15px rgba(168, 85, 247, 0.1);
        }

        .upload-box {
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.03);
            border: 2px dashed rgba(168, 85, 247, 0.4);
            position: relative;
            overflow: hidden;
        }

        .upload-box:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: #d8b4fe;
            transform: translateY(-2px);
        }

        .upload-box.has-image {
            border-style: solid;
            border-color: #4ade80;
            background: rgba(74, 222, 128, 0.1);
        }

        .glow-btn {
            background: linear-gradient(135deg, #7c3aed 0%, #db2777 100%);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .glow-btn:disabled {
            background: #4b5563;
            opacity: 0.5;
        }
        
        /* Premium Lock Styles */
        .premium-lock {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }
        .premium-lock::before {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; height: 2px;
            background: linear-gradient(90deg, transparent, #ffd700, transparent);
        }

        .bmc-btn {
            background-color: #FFDD00;
            color: #000000;
            font-weight: bold;
            transition: transform 0.2s;
            border: 2px solid #e6c800;
        }
        .bmc-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 221, 0, 0.3);
        }

        /* Tab Styles */
        .tab-btn {
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
            opacity: 0.6;
        }
        .tab-btn.active {
            opacity: 1;
            border-bottom-color: #d8b4fe;
            color: #fff;
            background: rgba(255,255,255,0.05);
        }

        .markdown-body h1, .markdown-body h2, .markdown-body h3 {
            color: #d8b4fe;
            margin-top: 1.5em;
            margin-bottom: 0.5em;
            font-weight: bold;
        }
        .markdown-body p {
            margin-bottom: 1em;
            line-height: 1.8;
            color: #e2d8f0;
        }
        .markdown-body strong { color: #ffd700; }
        
        .crystal-ball {
            width: 100px;
            height: 100px;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), rgba(216,180,254,0.4), rgba(124,58,237,0.8));
            border-radius: 50%;
            box-shadow: 0 0 30px #a855f7, inset 0 0 20px rgba(255,255,255,0.5);
            margin: 0 auto;
            position: relative;
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* Face Guide Overlay */
        .face-guide {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60%;
            height: 70%;
            border: 2px dashed rgba(255,255,255,0.2);
            border-radius: 50% 50% 60% 60%;
            pointer-events: none;
        }
        
        /* iOS optimizations */
        img {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-4xl mx-auto">
        
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="inline-block p-2 rounded-full border border-purple-500/30 mb-4 bg-purple-900/20">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#d8b4fe" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2zm0 18a8 8 0 1 1 8-8 8 8 0 0 1-8 8z"/><path d="M12 6v6l4 2"/></svg>
            </div>
            <h1 class="text-3xl md:text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-purple-300 to-pink-300 mb-2">
                AI å‘½ç†å¤§å¸ˆ
            </h1>
            <p class="text-purple-300/60 text-sm md:text-lg">AI Destiny Master Â· æ‰‹ç›¸ & é¢ç›¸</p>
        </div>

        <!-- Mode Switcher -->
        <div class="flex justify-center mb-8">
            <div class="bg-[#130722] p-1 rounded-xl border border-purple-500/30 flex">
                <button onclick="switchMode('hand')" id="tabHand" class="tab-btn active px-6 py-2 rounded-lg text-purple-200 font-medium flex items-center gap-2">
                    <span>âœ‹</span> æ‰‹ç›¸è§£è¯»
                </button>
                <button onclick="switchMode('face')" id="tabFace" class="tab-btn px-6 py-2 rounded-lg text-purple-200 font-medium flex items-center gap-2">
                    <span>ğŸ‘¤</span> é¢ç›¸è§£è¯»
                </button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left Panel: Uploads -->
            <div class="lg:col-span-1 space-y-6">
                
                <!-- HAND MODE -->
                <div id="handSection" class="space-y-6 transition-opacity duration-300">
                    <!-- Left Hand -->
                    <div class="relative p-4 bg-[#130722] rounded-xl mystic-border text-center">
                        <h3 class="text-lg font-semibold mb-2 text-purple-200">å·¦æ‰‹ (å…ˆå¤©)</h3>
                        <input type="file" id="fileLeft" class="hidden" accept="image/*" onchange="handleFileSelect(this, 'previewLeft', 'dropZoneLeft', 'leftHandBase64')">
                        <div class="upload-box rounded-lg p-4 h-40 flex flex-col items-center justify-center cursor-pointer relative" id="dropZoneLeft" onclick="document.getElementById('fileLeft').click()">
                            <div id="previewLeft" class="w-full h-full flex flex-col items-center justify-center">
                                <svg class="w-8 h-8 text-purple-400/50 mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                                <span class="text-xs text-purple-300/70">ç‚¹å‡»ä¸Šä¼ </span>
                            </div>
                            <img id="imgLeft" class="hidden w-full h-full object-cover rounded-md" alt="Left Hand">
                        </div>
                    </div>

                    <!-- Right Hand -->
                    <div class="relative p-4 bg-[#130722] rounded-xl mystic-border text-center">
                        <h3 class="text-lg font-semibold mb-2 text-purple-200">å³æ‰‹ (åå¤©)</h3>
                        <input type="file" id="fileRight" class="hidden" accept="image/*" onchange="handleFileSelect(this, 'previewRight', 'dropZoneRight', 'rightHandBase64')">
                        <div class="upload-box rounded-lg p-4 h-40 flex flex-col items-center justify-center cursor-pointer relative" id="dropZoneRight" onclick="document.getElementById('fileRight').click()">
                            <div id="previewRight" class="w-full h-full flex flex-col items-center justify-center">
                                <svg class="w-8 h-8 text-purple-400/50 mb-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                                <span class="text-xs text-purple-300/70">ç‚¹å‡»ä¸Šä¼ </span>
                            </div>
                            <img id="imgRight" class="hidden w-full h-full object-cover rounded-md" alt="Right Hand">
                        </div>
                    </div>
                </div>

                <!-- FACE MODE -->
                <div id="faceSection" class="hidden transition-opacity duration-300">
                    <div class="relative group h-[400px]">
                        <div class="absolute -inset-0.5 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-xl opacity-30 group-hover:opacity-75 transition duration-500 blur"></div>
                        <div class="relative h-full p-6 bg-[#130722] rounded-xl mystic-border text-center flex flex-col">
                            <h3 class="text-xl font-semibold mb-4 text-purple-200">é¢ç›¸æ‰«æ</h3>
                            <p class="text-xs text-gray-400 mb-4">è¯·ç¡®ä¿äº”å®˜æ¸…æ™°ï¼Œæ— é®æŒ¡</p>
                            
                            <input type="file" id="fileFace" class="hidden" accept="image/*" onchange="handleFileSelect(this, 'previewFace', 'dropZoneFace', 'faceBase64')">
                            <div class="upload-box rounded-lg flex-1 relative overflow-hidden flex flex-col items-center justify-center cursor-pointer" id="dropZoneFace" onclick="document.getElementById('fileFace').click()">
                                <!-- Guide Overlay -->
                                <div class="face-guide" id="faceGuide"></div>
                                <div id="previewFace" class="w-full h-full flex flex-col items-center justify-center z-10">
                                    <svg class="w-16 h-16 text-purple-400/50 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                    <span class="text-sm text-purple-300/70">ç‚¹å‡»æ‹æ‘„/ä¸Šä¼ è‡ªæ‹</span>
                                </div>
                                <img id="imgFace" class="hidden w-full h-full object-cover z-20" alt="Face Preview">
                            </div>
                        </div>
                    </div>
                </div>

                <button id="analyzeBtn" onclick="analyzeDestiny()" class="glow-btn w-full py-4 rounded-xl text-white font-bold text-lg tracking-widest flex items-center justify-center gap-3 disabled:opacity-50">
                    <span>ğŸ”®</span> <span id="btnText">å¼€å§‹è§£è¯»å‘½è¿</span>
                </button>
            </div>

            <!-- Right Panel: Results -->
            <div class="lg:col-span-2">
                <div class="h-full min-h-[500px] bg-[#130722]/80 rounded-2xl border border-purple-500/20 p-8 relative overflow-hidden flex flex-col">
                    <div id="resultPlaceholder" class="absolute inset-0 flex flex-col items-center justify-center text-purple-300/40 p-8 text-center">
                        <div class="text-6xl mb-4 opacity-20">â˜¯ï¸</div>
                        <p class="text-xl" id="placeholderText">è¯·ä¸Šä¼ ç…§ç‰‡<br>AI å¤§å¸ˆå°†ä¸ºæ‚¨æ­å¼€å‘½è¿è¿·é›¾</p>
                    </div>
                    <div id="loadingState" class="hidden absolute inset-0 z-20 flex flex-col items-center justify-center bg-[#130722]/90 backdrop-blur-sm">
                        <div class="crystal-ball mb-8"></div>
                        <h3 class="text-2xl text-purple-100 font-bold mb-2">å¤§å¸ˆé€šçµä¸­...</h3>
                        <p class="text-purple-300/70 animate-pulse" id="loadingText">æ­£åœ¨æ¨æ¼”å¤©æœº...</p>
                    </div>
                    <div id="resultContent" class="hidden relative z-10 flex flex-col h-full">
                        <div class="flex items-center justify-between mb-6 border-b border-purple-500/30 pb-4 flex-shrink-0">
                            <h2 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-200 to-pink-200" id="resultTitle">è§£è¯»æŠ¥å‘Š</h2>
                            <button onclick="resetApp()" class="text-sm text-purple-400 hover:text-white">æ¸…ç©º</button>
                        </div>
                        
                        <!-- Free Output -->
                        <div id="markdownOutput" class="markdown-body text-purple-100 leading-relaxed mb-6"></div>
                        
                        <!-- Premium Unlock -->
                        <div id="premiumSection" class="premium-lock p-6 mb-6">
                            <div id="lockedContent">
                                <div class="text-center mb-4">
                                    <h3 class="text-xl font-bold text-yellow-400 mb-2">ğŸ”’ æ·±åº¦é«˜é˜¶æŠ¥å‘Š (ä»˜è´¹è§£é”)</h3>
                                    <p class="text-sm text-gray-300">è§£é”åå³å¯æŸ¥çœ‹ä»¥ä¸‹å¤©æœºï¼š</p>
                                </div>
                                <ul class="space-y-2 text-sm text-gray-200 mb-6 pl-4">
                                    <li class="flex items-center gap-2">ğŸ’° <strong>æœªæ¥ 5 å¹´è´¢è¿</strong> (ç²¾ç¡®æµå¹´åˆ†æ)</li>
                                    <li class="flex items-center gap-2">â¤ï¸ <strong>æ­£ç¼˜æ¡ƒèŠ±æ–¹ä½</strong> (çœŸçˆ±å‡ºç°æ—¶æœº)</li>
                                    <li class="flex items-center gap-2">ğŸŒŸ <strong>å…·ä½“æ”¹è¿å»ºè®®</strong> (å¯æ‰§è¡Œçš„è½¬è¿æ³•)</li>
                                </ul>
                                <div class="flex flex-col gap-3">
                                    <!-- Tracking added to this button -->
                                    <a href="https://buymeacoffee.com/hhlove" target="_blank" 
                                       onclick="if(window.va) window.va('event', { name: 'click_buy_coffee' })"
                                       class="glow-btn text-center py-3 rounded-lg text-white font-bold">
                                        ç«‹å³è§£é” (Â¥9.9)
                                    </a>
                                    <div class="flex gap-2 mt-2">
                                        <input type="text" id="unlockCode" placeholder="è¾“å…¥å…‘æ¢ç " class="flex-1 bg-black/30 border border-purple-500/30 rounded-lg px-4 py-2 text-white focus:outline-none focus:border-purple-400">
                                        <button onclick="unlockPremium()" class="bg-purple-600 hover:bg-purple-500 text-white px-4 py-2 rounded-lg transition-colors">
                                            ç¡®è®¤
                                        </button>
                                    </div>
                                    <p class="text-xs text-center text-gray-500 mt-1">æ¼”ç¤ºå…‘æ¢ç : VIP888</p>
                                </div>
                            </div>
                            <div id="premiumLoading" class="hidden text-center py-8">
                                <div class="spinner mx-auto mb-4 w-8 h-8 border-2 border-yellow-400 border-t-transparent rounded-full animate-spin"></div>
                                <p class="text-yellow-200 animate-pulse">å¤§å¸ˆæ­£åœ¨å¼€å¯å¤©çœ¼ï¼Œæ·±åº¦æ¨æ¼”ä¸­...</p>
                            </div>
                            <div id="unlockedContent" class="hidden markdown-body text-purple-100 pt-4 border-t border-yellow-500/30"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="text-center mt-12 text-purple-500/40 text-sm">
            <p>AI ç»“æœä»…ä¾›å¨±ä¹ | Powered by Gemini 2.5</p>
        </div>
    </div>

    <script>
        let activeMode = 'hand';
        let leftHandBase64 = null;
        let rightHandBase64 = null;
        let faceBase64 = null;

        // âš ï¸ è®°å¾—åœ¨è¿™é‡Œå¡«å…¥ä½ çš„ API Key âš ï¸
        const apiKey = "AIzaSyB4DLlqz8O16D0-WyP29XqMwL_W5ybi3XY"; 

        function switchMode(mode) {
            activeMode = mode;
            document.getElementById('tabHand').classList.toggle('active', mode === 'hand');
            document.getElementById('tabFace').classList.toggle('active', mode === 'face');
            document.getElementById('handSection').classList.toggle('hidden', mode !== 'hand');
            document.getElementById('faceSection').classList.toggle('hidden', mode !== 'face');
            document.getElementById('placeholderText').innerHTML = mode === 'hand' ? "è¯·ä¸Šä¼ æ‰‹ç›¸ç…§ç‰‡<br>å¤§å¸ˆä¸ºæ‚¨çœ‹æŒä¸­ä¹¾å¤" : "è¯·ä¸Šä¼ é¢ç›¸è‡ªæ‹<br>å¤§å¸ˆä¸ºæ‚¨çœ‹ä¸‰åº­äº”çœ¼";
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        async function handleFileSelect(input, previewId, zoneId, stateVarName) {
            const file = input.files[0];
            if (!file) return;
            try {
                const base64 = await fileToBase64(file);
                document.getElementById(previewId).classList.add('hidden');
                const imgEl = document.getElementById(zoneId).querySelector('img');
                imgEl.classList.remove('hidden');
                imgEl.src = base64;
                document.getElementById(zoneId).classList.add('has-image');
                if (stateVarName === 'faceBase64') document.getElementById('faceGuide').style.display = 'none';
                const base64Data = base64.split(',')[1];
                if (stateVarName === 'leftHandBase64') leftHandBase64 = base64Data;
                if (stateVarName === 'rightHandBase64') rightHandBase64 = base64Data;
                if (stateVarName === 'faceBase64') faceBase64 = base64Data;
            } catch (e) { console.error(e); alert("å›¾ç‰‡è¯»å–å¤±è´¥"); }
        }

        async function analyzeDestiny() {
            if (activeMode === 'hand' && !leftHandBase64 && !rightHandBase64) return alert("è¯·è‡³å°‘ä¸Šä¼ ä¸€å¼ æ‰‹ç›¸");
            if (activeMode === 'face' && !faceBase64) return alert("è¯·ä¸Šä¼ é¢ç›¸");
            if (!apiKey) return alert("è¯·å…ˆé…ç½® API Key");

            document.getElementById('analyzeBtn').disabled = true;
            document.getElementById('loadingState').classList.remove('hidden');
            document.getElementById('resultPlaceholder').classList.add('hidden');
            document.getElementById('resultContent').classList.add('hidden');
            
            document.getElementById('lockedContent').classList.remove('hidden');
            document.getElementById('unlockedContent').classList.add('hidden');
            document.getElementById('unlockedContent').innerHTML = "";
            document.getElementById('unlockCode').value = "";

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const closingHook = "æœ€åï¼Œè¯·åŠ¡å¿…ä»¥è¿™å¥è¯ä½œä¸ºç»“å°¾ï¼š'...é™äºç¯‡å¹…ï¼Œæ‚¨çš„æµå¹´å¤§è¿å°šæœ‰ç„æœºï¼Œå»ºè®®å¤šè¡Œå–„ç§¯å¾·...'";

            let systemPrompt = activeMode === 'hand' 
                ? `ä½ æ˜¯ä¸€ä½ç²¾é€šä¸­å›½ä¼ ç»Ÿæ‰‹ç›¸çš„ç®—å‘½å¤§å¸ˆã€‚è¯·åˆ†æç”¨æˆ·ä¸Šä¼ çš„æ‰‹æŒç…§ç‰‡ã€‚åŒ…æ‹¬ç”Ÿå‘½çº¿ã€æ™ºæ…§çº¿ã€æ„Ÿæƒ…çº¿å’Œäº‹ä¸šè¿ã€‚ç”¨ç¥ç§˜ã€ä¸“ä¸šä½†ç§¯æçš„å£å»ï¼Œä½¿ç”¨ç®€ä½“ä¸­æ–‡ Markdown æ ¼å¼è¾“å‡ºã€‚${closingHook}`
                : `ä½ æ˜¯ä¸€ä½ç²¾é€šä¸­å›½ä¼ ç»Ÿé¢ç›¸çš„ç®—å‘½å¤§å¸ˆã€‚è¯·åˆ†æç”¨æˆ·ä¸Šä¼ çš„é¢éƒ¨ç…§ç‰‡ã€‚åŒ…æ‹¬ä¸‰åº­äº”çœ¼ã€é¢éƒ¨æ°”è‰²ã€æµå¹´è¿åŠ¿å’Œæ€§æ ¼ç‰¹å¾ã€‚ç”¨ç¥ç§˜ã€ä¸“ä¸šä½†ç§¯æçš„å£å»ï¼Œä½¿ç”¨ç®€ä½“ä¸­æ–‡ Markdown æ ¼å¼è¾“å‡ºã€‚${closingHook}`;

            const parts = [{ text: systemPrompt }];
            if (activeMode === 'hand') {
                if (leftHandBase64) parts.push({ inlineData: { mimeType: "image/jpeg", data: leftHandBase64 } });
                if (rightHandBase64) parts.push({ inlineData: { mimeType: "image/jpeg", data: rightHandBase64 } });
            } else {
                parts.push({ inlineData: { mimeType: "image/jpeg", data: faceBase64 } });
            }

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: parts }] })
                });
                const data = await response.json();
                if (data.error) throw new Error(data.error.message);
                
                const markdownText = data.candidates[0].content.parts[0].text;
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('resultContent').classList.remove('hidden');
                document.getElementById('resultTitle').textContent = activeMode === 'hand' ? "âœ‹ æ‰‹ç›¸å¤§å¸ˆè§£è¯»" : "ğŸ‘¤ é¢ç›¸å¤§å¸ˆè§£è¯»";
                document.getElementById('markdownOutput').innerHTML = marked.parse(markdownText);
            } catch (error) {
                console.error(error);
                alert("è§£è¯»å¤±è´¥: " + error.message);
                document.getElementById('loadingState').classList.add('hidden');
            } finally {
                document.getElementById('analyzeBtn').disabled = false;
                document.getElementById('btnText').textContent = "å†æ¬¡è§£è¯»";
            }
        }

        async function unlockPremium() {
            const code = document.getElementById('unlockCode').value.trim();
            if (code !== 'VIP888') {
                alert("å…‘æ¢ç æ— æ•ˆï¼Œè¯·æ£€æŸ¥æˆ–å‰å¾€è´­ä¹°ã€‚");
                return;
            }

            // Track Unlock Event
            if(window.va) window.va('event', { name: 'unlock_success' });

            document.getElementById('lockedContent').classList.add('hidden');
            document.getElementById('premiumLoading').classList.remove('hidden');

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            let premiumPrompt = `ä½ ä¾ç„¶æ˜¯é‚£ä½ç²¾é€šå‘½ç†çš„å¤§å¸ˆã€‚ç”¨æˆ·å·²ç»ä»˜è´¹è§£é”äº†æ·±åº¦æŠ¥å‘Šã€‚
            åŸºäºåˆšæ‰ä¸Šä¼ çš„ç›¸åŒæ‰‹ç›¸/é¢ç›¸å›¾ç‰‡ï¼Œè¯·å¿½ç•¥ä¹‹å‰çš„æ™®é€šåˆ†æï¼Œ**é‡ç‚¹æ·±åº¦åˆ†æä»¥ä¸‹ä¸‰ç‚¹**ï¼š
            1. **æœªæ¥ 5 å¹´è´¢è¿è¶‹åŠ¿**ï¼šè¯·æŒ‰å¹´ä»½åˆ—å‡ºï¼ˆä¾‹å¦‚2025, 2026...ï¼‰ï¼Œè¯¦ç»†è¯´æ˜è´¢è¿èµ·ä¼ã€‚
            2. **æ­£ç¼˜æ¡ƒèŠ±æ–¹ä½**ï¼šç»“åˆå…«å¦æ–¹ä½ï¼Œç»™å‡ºçœŸçˆ±å¯èƒ½å‡ºç°çš„å…·ä½“æ–¹å‘ã€åœºæ‰€å’Œæ—¶é—´ç‰¹å¾ã€‚
            3. **å…·ä½“æ”¹è¿å»ºè®®**ï¼šç»™å‡º3æ¡éå¸¸å…·ä½“çš„å»ºè®®ï¼ˆä¾‹å¦‚ä½©æˆ´ä»€ä¹ˆæè´¨/é¢œè‰²çš„é¥°å“ï¼Œå®¶é‡Œæ‘†æ”¾ä»€ä¹ˆï¼Œå¿Œè®³ä»€ä¹ˆï¼‰ã€‚
            è¯·ä½¿ç”¨ Markdown æ ¼å¼ï¼Œæ ‡é¢˜ä½¿ç”¨ âœ¨ ä¿®é¥°ï¼Œè¯­æ°”è¦éå¸¸è‚¯å®šã€ç¥ç§˜ä¸”ç»™äººå¸Œæœ›ã€‚`;

            const parts = [{ text: premiumPrompt }];
            if (activeMode === 'hand') {
                if (leftHandBase64) parts.push({ inlineData: { mimeType: "image/jpeg", data: leftHandBase64 } });
                if (rightHandBase64) parts.push({ inlineData: { mimeType: "image/jpeg", data: rightHandBase64 } });
            } else {
                parts.push({ inlineData: { mimeType: "image/jpeg", data: faceBase64 } });
            }

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: parts }] })
                });
                const data = await response.json();
                const markdownText = data.candidates[0].content.parts[0].text;

                document.getElementById('premiumLoading').classList.add('hidden');
                const unlockedDiv = document.getElementById('unlockedContent');
                unlockedDiv.classList.remove('hidden');
                unlockedDiv.innerHTML = marked.parse(markdownText);
            } catch (error) {
                console.error(error);
                alert("è§£é”å¤±è´¥ï¼Œè¯·é‡è¯•");
                document.getElementById('premiumLoading').classList.add('hidden');
                document.getElementById('lockedContent').classList.remove('hidden');
            }
        }

        function resetApp() {
            location.reload();
        }
    </script>
</body>
</html>
